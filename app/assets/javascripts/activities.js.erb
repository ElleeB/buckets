// Activity Prototype //
function Activity(dueDate) {
  this.dueDate = dueDate,

	this.formatDate = function() {
		// create new date object with the current activity's due date
		let date = new Date(dueDate).toDateString()
		let dateB = date.split(' ')

		dateB.splice(1, 0, ", ")
		let dateC = dateB.join(" ")

		let dateD = dateC.split(" ")
		dateD.splice(5, 0, ", ")
    // fix final date format - remove the day ex. "Sat"
		return dateD.join(" ")
	}
}

// Next Activity //
$(function () {
  $(".js-next").on("click", function(e) {
    e.preventDefault()
    const nextId = parseInt($(".js-next").attr("data-id")) + 1

    $.get("/activities/" + nextId + ".json", function(data) {
      const activity = data
      const newActivity = new Activity(activity["activity"]["due_date"])

      $("#activityTitle").text(activity["activity"]["title"])
      $("#categoryName").text(activity["activity_category"])
      $("#description").text(activity["activity"]["description"])
      $("#dueDate").text(newActivity.formatDate)


      // set the data id to current activity
      $(".js-next").attr("data-id", activity["activity"]["id"])
      $(".js-previous").attr("data-id", activity["activity"]["id"])
    })
  })
})

// Previous Activity //
$(function () {
  $(".js-previous").on("click", function(e) {
    e.preventDefault()
    const previousId = parseInt($(".js-previous").attr("data-id")) - 1

    $.get("/activities/" + previousId + ".json", function(data) {
      const activity = data
      const newActivity = new Activity(activity["activity"]["due_date"])

      $("#activityTitle").text(activity["activity"]["title"])
      $("#categoryName").text(activity["activity_category"])
      $("#description").text(activity["activity"]["description"])
      $("#dueDate").text(newActivity.formatDate)

      // set the data id to current activity
      $(".js-previous").attr("data-id", activity["activity"]["id"])
      $(".js-next").attr("data-id", activity["activity"]["id"])
    })
  })
})

// View Drop To-Dos //
$(function() {
  $("#view-todo-button").on("click", function() {
    $("#new-list-form").hide()
    $("#show-lists").show()
  })
})


// Add to do list //
$(function() {
  $("#add-todo-button").on("click", function() {
    $("#show-lists").hide()
    $("#new-list-form").show()
  })
})

// Post Request New List
$(function() {
  $("input#submit-new-list-button").on("click", function(e) {
    e.preventDefault()

    const activityId = parseInt($("#new-list-form").attr("data-id"))
    const values = $(`form#edit_activity_${activityId}`).serialize()
    const posting = $.ajax({
      url: `/activities/${activityId}`,
      data: values,
      type: 'PATCH',
      success: function(data) {
        const activity = data
        const lists = data["activity_lists"]
        $("#far-right").show()

        const farRightDiv = $("#far-right-column-content")
        farRightDiv.empty()

        lists.forEach(function(list) {
          farRightDiv.append(`<input type="checkbox" name="list_name" value="${list.name}"> ${list.name} <br>`)
        })
      }
    })
    $("#lists_name").val("")
  })
})
